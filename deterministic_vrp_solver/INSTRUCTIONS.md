# Инструкции по запуску детерминированного VRP решателя

## Описание

Детерминированный VRP решатель использует иерархическую декомпозицию через микрополигоны для решения задачи маршрутизации транспортных средств.

## Требования

- Python 3.11+
- 4 CPU
- 32 GB RAM
- Время выполнения: до 1 часа

## Структура данных

Убедитесь, что в корневой директории проекта находятся следующие файлы:

```
E-CUP-2025-ML-Challenge-VRP/
├── ml_ozon_logistic/
│   ├── ml_ozon_logistic_dataSetOrders.json
│   ├── ml_ozon_logistic_dataSetCouriers.json
│   └── ml_ozon_logistic_dataDurations.json
├── durations.sqlite
└── deterministic_vrp_solver/
    ├── main.py
    ├── requirements.txt
    └── ...
```

## Установка и запуск

### Способ 1: Прямой запуск

1. Перейдите в директорию решателя:
```bash
cd deterministic_vrp_solver
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Запустите алгоритм:
```bash
python main.py
```

### Способ 2: Использование скрипта

1. Запустите скрипт из корневой директории:
```bash
./deterministic_vrp_solver/run.sh
```

### Способ 3: Docker

1. Соберите образ:
```bash
cd deterministic_vrp_solver
docker build -t deterministic-vrp-solver .
```

2. Запустите контейнер:
```bash
docker run -v $(pwd)/..:/app/data deterministic-vrp-solver
```

## Выходные данные

После выполнения алгоритма будет создан файл `solution.json` со следующей структурой:

```json
{
  "routes": [
    {
      "courier_id": 1,
      "route": [0, 123, 456, 789, 0]
    },
    {
      "courier_id": 2,
      "route": [0, 234, 567, 890, 0]
    }
  ]
}
```

Где:
- `courier_id` - идентификатор курьера
- `route` - маршрут курьера (0 = склад, остальные числа = ID заказов)

## Логирование

Алгоритм создает подробные логи в файле `deterministic_vrp.log`, включающие:

- Время выполнения каждого этапа
- Статистику по полигонам и маршрутам
- Результаты валидации
- Ошибки и предупреждения

## Алгоритм

### Этап 1: Загрузка и агрегация данных
- Загрузка заказов, курьеров и матрицы расстояний
- Агрегация заказов по микрополигонам

### Этап 2: Оптимизация полигонов
- Решение TSP внутри каждого микрополигона
- Вычисление порталов полигонов

### Этап 3: Назначение полигонов
- Назначение микрополигонов курьерам
- Использование OR-Tools CP-SAT или эвристики

### Этап 4: Оптимизация маршрутов
- Оптимизация порядка обхода полигонов
- Локальный поиск для улучшения

### Этап 5: Генерация решения
- Формирование финальных маршрутов
- Валидация и сохранение

## Ограничения

- Время работы каждого курьера ≤ 12 часов (43200 секунд)
- Атомарность микрополигонов (полигон не дробится между курьерами)
- Каждый заказ обслуживается ровно один раз

## Устранение неполадок

### Ошибка "Файл не найден"
Убедитесь, что все необходимые файлы данных находятся в правильных директориях.

### Ошибка "Недостаточно памяти"
Увеличьте доступную память или используйте машину с большим объемом RAM.

### Медленная работа
Алгоритм может работать медленно на больших полигонах. Для ускорения можно:
- Уменьшить количество итераций локального поиска
- Использовать только эвристические методы
- Увеличить лимит времени для OR-Tools

## Контакты

При возникновении проблем обращайтесь к документации или создавайте issue в репозитории.
