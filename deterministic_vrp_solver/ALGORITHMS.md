# Алгоритмы решения VRP

## Обзор алгоритмов

В проекте реализованы различные подходы к решению задачи назначения полигонов курьерам:

### 1. Статические алгоритмы
- **OR-Tools** - глобальная оптимизация
- **Pyomo** - математическое программирование
- **Эвристический** - жадный алгоритм + локальный поиск

### 2. Динамические алгоритмы ⭐ **НОВОЕ**
- **Dynamic Scheduler** - базовый динамический планировщик
- **Smart Dynamic Scheduler** - умный планировщик с приоритетами

## Динамический планировщик

### **Принцип работы:**

```
Время: 0:00 - Все курьеры свободны
├── Курьер 1 получает полигон A (время выполнения: 2 часа)
├── Курьер 2 получает полигон B (время выполнения: 1.5 часа)
└── Курьер 3 получает полигон C (время выполнения: 3 часа)

Время: 1:30 - Курьер 2 освобождается
├── Курьер 2 получает полигон D (ближайший к текущему местоположению)
└── Курьеры 1 и 3 продолжают работу

Время: 2:00 - Курьер 1 освобождается
├── Курьер 1 получает полигон E
└── Курьер 2 продолжает работу с полигоном D
```

### **Ключевые особенности:**

1. **Учет времени освобождения** - курьеры получают новые задачи сразу после завершения
2. **Динамическое перераспределение** - задачи назначаются по мере освобождения ресурсов
3. **Оптимизация маршрутов** - учитывается текущее местоположение курьера

## Умный динамический планировщик

### **Дополнительные возможности:**

#### **1. Приоритизация полигонов**
```python
priority = order_count / cost  # Больше заказов = выше приоритет
```

#### **2. Оценка близости**
```python
proximity_score = 1.0 - distance / max_reasonable_distance
```

#### **3. Срочность**
```python
urgency = min(1.0, current_time / 3600)  # Увеличивается со временем
```

#### **4. Комплексная оценка назначения**
```python
total_score = (
    proximity_score * 0.3 +      # Близость (30%)
    efficiency_score * 0.2 +     # Эффективность курьера (20%)
    priority_score * 0.2 +       # Приоритет полигона (20%)
    urgency_score * 0.15 +       # Срочность (15%)
    wait_score * 0.15            # Время ожидания (15%)
)
```

## Сравнение алгоритмов

| Критерий | Статические | Динамический | Умный динамический |
|----------|-------------|--------------|-------------------|
| Учет времени освобождения | ❌ | ✅ | ✅ |
| Оптимизация маршрутов | ❌ | ✅ | ✅ |
| Приоритизация | ❌ | ❌ | ✅ |
| Срочность | ❌ | ❌ | ✅ |
| Производительность | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| Качество решения | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Сложность реализации | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |

## Использование

### **Базовый динамический планировщик:**
```python
from solver_factory import AssignmentSolverFactory

solver = AssignmentSolverFactory.create_solver(
    solver_type='dynamic',
    distance_provider=distance_provider,
    warehouse_id=1
)

assignment = solver.solve(polygons_df, couriers_df)
```

### **Умный динамический планировщик:**
```python
solver = AssignmentSolverFactory.create_solver(
    solver_type='smart_dynamic',
    distance_provider=distance_provider,
    warehouse_id=1
)

assignment = solver.solve(polygons_df, couriers_df)
```

## Преимущества динамических алгоритмов

### **1. Эффективность использования ресурсов**
- Курьеры не простаивают
- Максимальная загрузка персонала
- Снижение общего времени выполнения

### **2. Адаптивность**
- Реакция на изменения в реальном времени
- Учет текущей ситуации
- Гибкость планирования

### **3. Оптимизация маршрутов**
- Минимизация времени в пути
- Учет текущего местоположения
- Снижение затрат на логистику

### **4. Масштабируемость**
- Легко добавлять новых курьеров
- Динамическое перераспределение нагрузки
- Балансировка загрузки

## Пример работы

### **Сценарий:**
- 3 курьера
- 10 полигонов разной сложности
- Ограничение: 8 часов на курьера

### **Статический алгоритм:**
```
Курьер 1: Полигоны [A, B, C] - время: 7.5 часов
Курьер 2: Полигоны [D, E, F] - время: 6.0 часов  
Курьер 3: Полигоны [G, H, I, J] - время: 8.0 часов
```

### **Динамический алгоритм:**
```
Время 0:00: Курьер 1 → A, Курьер 2 → D, Курьер 3 → G
Время 2:00: Курьер 2 освободился → получает E
Время 3:00: Курьер 1 освободился → получает B
Время 4:00: Курьер 2 освободился → получает F
Время 5:00: Курьер 3 освободился → получает H
Время 6:00: Курьер 1 освободился → получает C
Время 7:00: Курьер 2 освободился → получает I
Время 8:00: Курьер 3 освободился → получает J
```

### **Результат:**
- **Статический**: 8.0 часов (максимум)
- **Динамический**: 6.5 часов (среднее время)
- **Экономия времени**: 18.75%

## Рекомендации по выбору алгоритма

### **Используйте статические алгоритмы, если:**
- Задача небольшая (< 50 полигонов)
- Нужна гарантированная оптимальность
- Время выполнения не критично

### **Используйте динамические алгоритмы, если:**
- Задача большая (> 50 полигонов)
- Важна эффективность использования ресурсов
- Нужна адаптивность к изменениям

### **Используйте умный динамический планировщик, если:**
- Есть приоритеты среди полигонов
- Важна срочность выполнения
- Нужна максимальная оптимизация
