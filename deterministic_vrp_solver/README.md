# Детерминированный VRP Solver через микрополигоны

## Описание подхода

Данный решатель использует детерминированную декомпозицию задачи VRP через микрополигоны (MpId):

1. **Иерархическая декомпозиция**: задача разбивается на два уровня:
   - Назначение микрополигонов курьерам
   - Оптимизация маршрутов внутри полигонов

2. **Атомарность полигонов**: каждый микрополигон обслуживается целиком одним курьером

3. **TSP внутри полигонов**: для каждого полигона решается задача коммивояжёра (до 15 точек)

4. **Оптимизация назначений**: используется Integer Programming или эвристический алгоритм

## Структура проекта

```
deterministic_vrp_solver/
├── main.py                 # Основной скрипт запуска
├── data_processor.py       # Обработка и агрегация данных
├── polygon_optimizer.py    # TSP внутри полигонов
├── assignment_solver.py    # Назначение полигонов курьерам
├── route_optimizer.py      # Оптимизация маршрутов курьеров
├── solution_generator.py   # Генерация финального решения
├── utils.py               # Вспомогательные функции
├── requirements.txt       # Зависимости
└── README.md             # Документация
```

## Установка и запуск

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Запустите решатель:
```bash
python main.py
```

## Алгоритм

### 1. Предварительная обработка
- Загрузка данных о заказах, курьерах и матрице расстояний
- Агрегация заказов по микрополигонам
- Вычисление внутриполигонных стоимостей через TSP
- Определение порталов полигонов

### 2. Назначение полигонов
- Формулировка задачи как Integer Programming
- Ограничения: время ≤ 12 часов, атомарность полигонов
- Решение через OR-Tools CP-SAT или эвристику

### 3. Оптимизация маршрутов
- TSP на уровне полигонов для каждого курьера
- Оптимизация порядка обхода полигонов
- Проверка ограничений по времени

### 4. Генерация решения
- Формирование финальных маршрутов
- Валидация всех ограничений
- Сохранение в формате solution.json

## Особенности реализации

- Использование Polars для эффективной обработки данных
- Многопоточность для параллельных вычислений
- Кэширование результатов TSP для ускорения
- Логирование процесса оптимизации

## Ожидаемые результаты

- Время выполнения: < 1 часа
- Соблюдение ограничения 12 часов на курьера
- Атомарность микрополигонов
- Минимизация суммарного времени работы
