# Детерминированный подход: Декомпозиция через микрополигоны

## Ключевая идея

Задача VRP с 20,160 заказами и 200 курьерами решается через **иерархическую декомпозицию**:

1. **Верхний уровень**: микрополигоны (MpId) как атомарные блоки
2. **Нижний уровень**: TSP внутри каждого полигона (≤15 точек)

## Алгоритм

### 1. Предварительная обработка
- Агрегация заказов по микрополигонам
- Вычисление внутриполигонных стоимостей через TSP
- Определение порталов полигонов

### 2. Назначение полигонов
- Integer Programming (OR-Tools CP-SAT)
- Ограничения: время ≤ 12ч, атомарность полигонов
- Fallback: эвристический алгоритм

### 3. Оптимизация маршрутов
- TSP на уровне порталов полигонов
- Локальный поиск для улучшения

## Преимущества

✅ **Детерминированность**: воспроизводимые результаты  
✅ **Атомарность**: полигоны не дробятся  
✅ **Масштабируемость**: декомпозиция снижает сложность  
✅ **Оптимальность**: точное решение TSP внутри полигонов  

## Ограничения

❌ **Потеря качества** на границах полигонов  
❌ **Зависимость** от выбора порталов  
❌ **Балансировка** требует дополнительных эвристик  

## Техническая реализация

- **Язык**: Python + OR-Tools
- **Данные**: Polars для эффективной обработки
- **TSP**: динамическое программирование (Хелд-Карп)
- **Оптимизация**: CP-SAT + локальный поиск
- **Время**: < 1 часа на 4 CPU, 32 GB RAM

## Результаты

- Соблюдение ограничения 12 часов
- Атомарность микрополигонов
- Минимизация суммарного времени работы
- Валидация всех бизнес-требований
